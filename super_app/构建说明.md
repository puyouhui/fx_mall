# 管理员App构建说明

## 环境说明

管理员App支持三种环境，通过编译参数 `APP_ENV` 切换：

### 1. 模拟器环境 (`APP_ENV=emulator`)
- **用途**: Android 模拟器调试
- **API地址**: `http://10.0.2.2:8082/api/mini`
- **说明**: 模拟器使用特殊IP `10.0.2.2` 访问宿主机

### 2. 真机调试环境 (`APP_ENV=device`)
- **用途**: 真机连接本地后端进行调试
- **API地址**: `http://192.168.1.3:8082/api/mini`
- **要求**: 
  - 手机和电脑在同一局域网
  - 后端服务在 `192.168.1.3:8082` 运行
  - 如果IP不同，请修改 `lib/utils/config.dart` 中的 `devBaseUrl`

### 3. 生产环境 (`APP_ENV=prod`)
- **用途**: 正式发布到生产服务器
- **API地址**: `https://mall.sscchh.com/api_mall/mini`
- **要求**: 
  - 设备必须能够访问互联网
  - 能够解析域名 `mall.sscchh.com`
  - 通过 Nginx 代理访问后端

## 构建脚本

### 开发环境（真机调试）
```bash
# Windows
cd super_app
build-dev.bat

# macOS/Linux
cd super_app
chmod +x build-dev.sh
./build-dev.sh
```
**使用场景**: 本地开发调试，手机连接电脑后端

### 生产环境
```bash
# Windows
cd super_app
build-prod.bat

# macOS/Linux
cd super_app
chmod +x build-prod.sh
./build-prod.sh
```
**使用场景**: 正式发布，设备需要能够访问互联网和生产服务器

## 常见问题

### 1. DNS解析失败
**错误**: `Failed host lookup: 'mall.sscchh.com'`

**原因**: 在开发/测试环境使用了生产环境构建

**解决方案**:
- 如果是本地调试，使用 `build-dev.bat` 重新编译
- 确保设备可以访问互联网并解析域名
- 检查网络连接和DNS配置

### 2. 连接超时
**原因**: 
- 手机和电脑不在同一局域网（真机调试）
- 防火墙阻止了8082端口
- IP地址配置错误

**解决方案**:
- 检查手机和电脑是否连接同一WiFi
- 检查电脑防火墙设置
- 确认 `config.dart` 中的IP地址是否正确

### 3. 404错误
**原因**: API路径不匹配

**解决方案**:
- 生产环境使用 `/api_mall/mini`
- 开发环境使用 `/api/mini`
- 确认后端服务正常运行

## 配置文件位置

配置文件: `lib/utils/config.dart`

关键配置项:
- `devBaseUrl`: 真机调试的IP地址（默认: `http://192.168.1.3:8082`）
- `emulatorBaseUrl`: 模拟器访问地址（默认: `http://10.0.2.2:8082`）
- `prodBaseUrl`: 生产环境域名（默认: `https://mall.sscchh.com`）

## 修改本地IP地址

如果您的电脑局域网IP不是 `192.168.1.3`，请修改 `lib/utils/config.dart`:

```dart
// 真机调试（局域网 IP）
static const String devBaseUrl = 'http://您的IP:8082';
```

然后重新编译。

