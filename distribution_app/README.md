## 配送员端应用 `distribution_app` 需求说明

### 一、项目概述

- **项目名称**: 配送员端应用 `distribution_app`  
- **定位**: 面向配送员的移动端 Flutter 应用  
- **目标**:  
  - 支持配送员登录、接单、取货、送达全流程操作  
  - 首页即「接单大厅」，方便配送员快速批量接单  
  - 提供「我的」页面，管理个人信息与统计数据  

> 当前阶段先聚焦三个核心页面：**登录页**、**接单大厅（主页面）**、**我的页面**，其他取货/配送详情后续迭代补充。

---

### 二、整体导航结构（路由草案）

- **启动流程**
  - 启动应用 → 判断是否已登录：
    - 已登录：直接进入「接单大厅」  
    - 未登录：进入「登录页」
- **Tab 结构（底部导航）**
  - Tab1：`接单大厅`（默认选中）
  - Tab2：`我的`

> 登录成功后进入带底部导航的主框架：上方为页面内容区，下方为两个 Tab。

---

### 三、登录页

- **页面入口**
  - 启动时未登录自动跳转
  - 「我的」页面未登录状态下点击登录按钮也可跳转

- **页面布局（示意）**
  - App Logo / 标题（配送员端）
  - 手机号输入框
  - 验证码输入框 + 获取验证码按钮
  - 登录按钮
  - 底部协议文案（可选）：同意《用户协议》《隐私政策》

- **基础交互**
  - 手机号格式校验（11 位数字）
  - 获取验证码按钮：
    - 校验手机号非空且格式正确
    - 点击后开始倒计时（例如 60 秒），期间按钮置灰不可再点
  - 登录按钮：
    - 校验手机号与验证码均已填写
    - 调用登录接口
    - 登录成功后保存 Token，并跳转到「接单大厅」

- **接口示例**
  - `POST /api/delivery/login`
    - 入参：
      - `phone`: string
      - `code`: string
    - 返回：
      - `token`: string
      - `courierId`: string
      - `name`: string

---

### 四、接单大厅（主页面）

> 应用登录后默认进入的主页面，也是底部 Tab1。

- **页面目标**
  - 集中展示可接的订单列表（订单池）
  - 支持配送员多选订单，一键接单
  - 为后续路线规划提供基础数据（当前 README 只定义接单阶段）

- **页面结构**
  - 顶部区域：
    - 标题：接单大厅
    - 简要统计：当前可接订单总数
    - 筛选入口（可放在右上角图标）
  - 订单列表区域（支持下拉刷新、上拉加载）：
    - 单条订单卡片信息：
      - 订单号（或短号）
      - 供应商/门店名称
      - 取货地址（简略）
      - 收货地址（简略）
      - 预计送达时间 / 时效类型（如：当日达、次日达）
      - 预估里程/预估时间（后端或地图服务提供）
      - 订单备注（若有）
    - 左侧勾选框：支持多选订单
  - 底部操作区：
    - 显示已选订单数量：如「已选 3 单」
    - 主按钮：`接单`（多选批量接单）

- **基础交互**
  - 下拉刷新：重新请求订单池列表
  - 多选：
    - 单条点击勾选框或整行（视 UI 交互设计）
    - 支持全选（可选）
  - 点击订单卡片：可进入「订单详情」页（此处仅预留，后续文档再补充）
  - 接单按钮：
    - 若未选择订单，按钮置灰或点击提示「请先选择订单」
    - 若已选择：弹出确认弹窗（展示已选订单数）→ 确认后调用接单接口

- **接口示例**
  - 查询订单池：`GET /api/delivery/order_pool`
    - 查询参数（可选）：
      - `regionId`: string  区域/片区
      - `supplierId`: string  供应商/门店
      - `sortBy`: string  排序方式（如：`timeAsc`、`distanceAsc`）
    - 返回：订单列表数组

  - 批量接单：`POST /api/delivery/take_orders`
    - 入参：
      - `orderIds`: string[]
    - 返回：
      - `success`: boolean
      - `failedOrderIds`: string[] （接单失败的订单 ID 列表）
      - `message`: string

- **状态处理**
  - 接单成功：
    - 提示「接单成功」
    - 可选择：
      - 直接跳转到「进行中订单/取货列表」（后续页面）
      - 或留在接单大厅继续接单
  - 接单部分成功：
    - 提示「部分订单接单失败」，可展示失败原因列表
  - 接单失败：
    - 弹出错误提示（如「订单已被其他配送员接走」）

---

### 五、我的页面

> 底部 Tab2，对应「我的」页面。

- **页面状态**：分为「已登录」与「未登录」两种展示。

- **未登录状态**
  - 顶部区域展示「未登录」与一个主按钮：`登录 / 注册`
  - 点击按钮跳转到「登录页」

- **已登录状态**
  - 顶部个人信息区：
    - 头像（占位图即可）
    - 姓名
    - 配送员编号（或工号）
    - 所属站点/区域（如有）
  - 工作状态切换：
    - 开关按钮：`接单中` / `休息中`
    - 切换时调用状态更新接口，决定是否从订单池中接单
  - 今日数据概览：
    - 今日已完成订单数
    - 今日配送里程（可选）
    - 今日预估收入（若业务需要）
  - 功能入口列表（按需逐步实现）：
    - 我的进行中订单
    - 历史订单
    - 帮助与反馈
    - 设置（通知、定位权限说明等）
  - 底部操作：
    - `退出登录` 按钮（弹出确认弹窗）

- **接口示例**
  - 获取个人信息：`GET /api/delivery/profile`
    - 返回：
      - `name`: string
      - `courierId`: string
      - `stationName`: string
      - `todayFinishedCount`: number
      - `todayDistanceKm`: number
      - `todayIncome`: number
      - `status`: string (`ON_DUTY` / `OFF_DUTY`)

  - 更新工作状态：`POST /api/delivery/status`
    - 入参：
      - `status`: string (`ON_DUTY` / `OFF_DUTY`)

  - 退出登录：前端本地清理 Token，并可调用后端登出接口：`POST /api/delivery/logout`

---

### 六、后续扩展预留

当前 README 只定义三个基础页面：**登录页**、**接单大厅**、**我的页面**，便于快速搭建 Flutter 界面与路由结构。  
后续可在此基础上新增以下文档或模块说明：

- `取货路线规划` 页面与流程说明  
- `配送路线规划` 页面与流程说明  
- `订单详情 / 签收` 页面说明  
- 异常处理（取货失败、配送失败等）流程说明  

这些都可以基于当前的三大页面继续拆分子页面来实现。
