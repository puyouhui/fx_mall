# 订单状态系统说明

## 当前有效状态（6个）

### 1. **pending_delivery** - 待配送
- **说明**：订单已创建，等待配送员接单或开始配送
- **创建时默认状态**：订单创建时自动设置为 `pending_delivery`
- **可流转到**：
  - `pending_pickup`（待取货）
  - `cancelled`（取消订单）

### 2. **pending_pickup** - 待取货
- **说明**：配送员已接单，需要到供应商处取货
- **可流转到**：
  - `delivering`（开始配送）
  - `cancelled`（取消订单）

### 3. **delivering** - 配送中
- **说明**：配送员已取货，正在配送途中
- **可流转到**：
  - `delivered`（已送达）
- **注意**：配送中不能取消订单

### 4. **delivered** - 已送达
- **说明**：订单已送达客户，等待收款
- **可流转到**：
  - `paid`（已收款）

### 5. **paid** - 已收款
- **说明**：订单已完成收款，订单流程结束
- **特点**：最终状态，不能再流转

### 6. **cancelled** - 已取消
- **说明**：订单已取消
- **特点**：最终状态，不能再流转
- **可取消的时机**：
  - `pending_delivery` 时可以取消
  - `pending_pickup` 时可以取消
  - **注意**：`delivering`（配送中）不能取消

## 兼容的旧状态（逐步迁移）

系统为了兼容历史数据，还支持以下旧状态，但新订单不会使用：

- **pending**：旧版本的"待配送"，系统会自动视为 `pending_delivery`
- **shipped**：旧版本的"已发货"，系统会自动视为 `delivered`
- **completed**：旧版本的"已完成"，系统会自动视为 `paid`

## 状态流转图

```
订单创建
   ↓
pending_delivery（待配送） ← 可以取消 → cancelled（已取消）
   ↓
pending_pickup（待取货） ← 可以取消 → cancelled（已取消）
   ↓
delivering（配送中）[不能取消]
   ↓
delivered（已送达）
   ↓
paid（已收款）[最终状态]
```

## 状态说明

| 状态 | 中文名称 | 说明 | 是否可取消 | 是否最终状态 |
|------|---------|------|-----------|------------|
| pending_delivery | 待配送 | 订单已创建，等待配送 | ✅ 是 | ❌ 否 |
| pending_pickup | 待取货 | 配送员已接单，待取货 | ✅ 是 | ❌ 否 |
| delivering | 配送中 | 正在配送途中 | ❌ 否 | ❌ 否 |
| delivered | 已送达 | 已送达，等待收款 | ❌ 否 | ❌ 否 |
| paid | 已收款 | 订单完成 | ❌ 否 | ✅ 是 |
| cancelled | 已取消 | 订单已取消 | ❌ 否 | ✅ 是 |

## 代码位置

- **状态定义**：`go_backend/internal/model/order.go` 第21行
- **状态验证**：`go_backend/internal/api/order_admin.go` 第386-393行
- **状态流转逻辑**：`go_backend/internal/api/order_admin.go` 第429-463行

