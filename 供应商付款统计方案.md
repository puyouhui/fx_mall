# 供应商付款统计系统设计方案

## 一、需求分析

### 1.1 核心需求
- 统计每个供应商的应付款金额
- 查看供应商的详细订单清单
- 按订单状态筛选（已结算/已收款订单）
- 按时间范围筛选
- 保证数据准确性

### 1.2 计算逻辑
**供应商应付款 = Σ(订单商品成本价 × 数量)**

其中：
- 商品成本价从 `products.specs` JSON 中的 `cost` 字段获取
- 只统计已结算的订单（`orders.status = 'paid'` 且 `orders.settlement_date IS NOT NULL`）
- 按订单商品关联的供应商分组统计

## 二、数据库设计

### 2.1 供应商付款记录表（可选，用于历史记录）
```sql
CREATE TABLE IF NOT EXISTS supplier_payments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    supplier_id INT NOT NULL COMMENT '供应商ID',
    payment_date DATE NOT NULL COMMENT '付款日期',
    amount DECIMAL(10,2) NOT NULL COMMENT '付款金额',
    order_ids TEXT COMMENT '关联订单ID列表（JSON格式）',
    status TINYINT DEFAULT 0 COMMENT '状态：0-待付款，1-已付款',
    remark TEXT COMMENT '备注',
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL,
    KEY idx_supplier_id (supplier_id),
    KEY idx_payment_date (payment_date),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='供应商付款记录表';
```

### 2.2 实时计算（推荐方案）
不创建额外表，直接从订单表实时计算，保证数据准确性。

## 三、API 设计

### 3.1 获取供应商付款统计列表
```
GET /admin/suppliers/payments/stats
参数：
- time_range: today/week/month (可选，默认全部)
- status: pending/paid (可选，默认全部)
- supplier_id: 供应商ID (可选)

返回：
{
  "code": 200,
  "data": [
    {
      "supplier_id": 1,
      "supplier_name": "供应商A",
      "total_amount": 12345.67,
      "order_count": 25,
      "pending_amount": 5000.00,
      "paid_amount": 7345.67
    }
  ]
}
```

### 3.2 获取供应商详细付款清单
```
GET /admin/suppliers/:id/payments/detail
参数：
- start_date: 开始日期 (可选)
- end_date: 结束日期 (可选)
- status: pending/paid (可选)

返回：
{
  "code": 200,
  "data": {
    "supplier_id": 1,
    "supplier_name": "供应商A",
    "total_amount": 12345.67,
    "orders": [
      {
        "order_id": 123,
        "order_number": "20240101120000123456",
        "order_date": "2024-01-01",
        "settlement_date": "2024-01-05",
        "status": "paid",
        "items": [
          {
            "product_id": 1,
            "product_name": "商品A",
            "spec_name": "规格1",
            "quantity": 10,
            "cost_price": 5.50,
            "subtotal": 55.00
          }
        ],
        "total_cost": 55.00
      }
    ]
  }
}
```

## 四、前端页面设计

### 4.1 供应商管理页面增强
- 在供应商列表中添加"付款统计"按钮
- 显示每个供应商的应付款总额（快速预览）

### 4.2 供应商付款统计页面
- 供应商列表（卡片形式）
- 每个供应商显示：
  - 供应商名称
  - 应付款总额
  - 订单数量
  - 待付款/已付款金额
- 点击查看详细清单
- 支持按时间范围筛选
- 支持导出Excel

## 五、实现步骤

1. 创建后端API接口
2. 创建前端页面
3. 添加路由配置
4. 测试验证

