# 生产环境迁移检查清单

## 迁移前检查 ✅

- [ ] 已备份生产数据库
- [ ] 已确认生产环境 `config.json` 配置正确
- [ ] 已选择业务低峰期（建议凌晨）
- [ ] 已通知相关人员迁移计划
- [ ] 已准备回滚方案

## 迁移步骤 ✅

- [ ] 1. 部署新代码到生产环境
- [ ] 2. 重启后端服务，确认 `image_index` 表已创建
- [ ] 3. 检查日志：`图片索引表初始化成功`
- [ ] 4. 编译迁移工具（或在本地编译 Linux 版本后上传）
- [ ] 5. 运行迁移脚本：`./migrate_images`
- [ ] 6. 等待迁移完成，记录迁移结果

## 迁移后验证 ✅

- [ ] 1. 检查数据库记录数：`SELECT COUNT(*) FROM image_index;`
- [ ] 2. 检查分类统计：`SELECT category, COUNT(*) FROM image_index GROUP BY category;`
- [ ] 3. 访问管理后台图库管理页面
- [ ] 4. 测试分页功能（第1页、第10页等）
- [ ] 5. 测试分类筛选功能
- [ ] 6. 测试搜索功能（如果有）
- [ ] 7. 测试上传新图片，确认自动写入索引
- [ ] 8. 测试删除图片，确认同步删除索引
- [ ] 9. 检查查询速度（应该从9秒降到<100ms）

## 监控指标 📊

迁移过程中监控：
- [ ] 数据库连接数正常
- [ ] 服务器 CPU 使用率 < 80%
- [ ] 服务器内存使用率正常
- [ ] MinIO 访问正常

迁移完成后监控：
- [ ] 图库管理页面响应时间 < 100ms
- [ ] 无错误日志
- [ ] 数据库 `image_index` 表记录数正确

## 回滚准备 🔄

如果出现问题，回滚步骤：
- [ ] 1. 代码回滚到旧版本（使用 MinIO 直接查询）
- [ ] 2. 重启后端服务
- [ ] 3. 验证功能恢复正常
- [ ] 4. 分析问题原因

## 迁移记录 📝

**迁移时间**：____年____月____日 ____:____

**迁移结果**：
- 成功迁移：____ 张图片
- 跳过重复：____ 条记录
- 错误记录：____ 条

**执行人**：________________

**备注**：________________________________________________

