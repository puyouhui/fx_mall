# 员工端（uniappX）实现方案

## 一、uniappX 可行性确认

✅ **uniappX 完全可以实现以下功能：**
- 跨平台开发（Android、iOS、小程序、H5）
- Vue 3 + TypeScript 支持
- 原生渲染，性能更好
- 支持 HTTP 请求、本地存储、地图定位等功能
- 支持拨打电话、导航等原生功能

## 二、需要实现的功能

### 1. 配送员功能
- ✅ 登录认证
- ✅ 查看待配送订单列表
- ✅ 接单（将订单状态改为"配送中"）
- ✅ 查看订单详情（地址、商品、联系方式等）
- ✅ 完成配送（将订单状态改为"已送达"）
- ✅ 查看我的配送订单（配送中、已送达）

### 2. 销售员功能
- ✅ 登录认证
- ✅ 查看我的客户列表
- ✅ 为客户创建订单（选择客户、商品、地址）
- ✅ 查看客户订单列表
- ✅ 查看客户信息
- ✅ 查看客户采购单

## 三、已实现的后端 API

### 1. 员工认证相关 ✅
- `POST /api/mini/employee/login` - 员工登录（手机号+密码）
- `GET /api/mini/employee/info` - 获取当前员工信息
- 员工认证中间件 `EmployeeAuthMiddleware` ✅

### 2. 配送员相关 API ✅
- `GET /api/mini/employee/delivery/orders` - 获取待配送订单列表（支持status参数筛选）
- `GET /api/mini/employee/delivery/orders/:id` - 获取订单详情
- `PUT /api/mini/employee/delivery/orders/:id/accept` - 接单（pending_delivery -> delivering）
- `PUT /api/mini/employee/delivery/orders/:id/complete` - 完成配送（delivering -> delivered）
- `GET /api/mini/employee/delivery/my-orders` - 获取我的配送订单（通过status参数筛选）

### 3. 销售员相关 API ✅
- `GET /api/mini/employee/sales/customers` - 获取我的客户列表（支持keyword搜索）
- `GET /api/mini/employee/sales/customers/:id` - 获取客户详情
- `GET /api/mini/employee/sales/customers/:id/orders` - 获取客户的订单列表
- `GET /api/mini/employee/sales/customers/:id/purchase-list` - 获取客户的采购单
- `POST /api/mini/employee/sales/orders` - 为客户创建订单
- `GET /api/mini/employee/sales/products` - 获取商品列表（预留接口）

## 四、API 使用说明

### 认证方式
所有需要认证的接口都需要在请求头中添加：
```
Authorization: Bearer {token}
```

### 配送员接口示例

**1. 登录**
```http
POST /api/mini/employee/login
Content-Type: application/json

{
  "phone": "13800138000",
  "password": "123456"
}
```

**2. 获取待配送订单**
```http
GET /api/mini/employee/delivery/orders?pageNum=1&pageSize=10&status=pending_delivery
Authorization: Bearer {token}
```

**3. 接单**
```http
PUT /api/mini/employee/delivery/orders/123/accept
Authorization: Bearer {token}
```

**4. 完成配送**
```http
PUT /api/mini/employee/delivery/orders/123/complete
Authorization: Bearer {token}
```

### 销售员接口示例

**1. 获取客户列表**
```http
GET /api/mini/employee/sales/customers?pageNum=1&pageSize=10&keyword=张三
Authorization: Bearer {token}
```

**2. 为客户创建订单**
```http
POST /api/mini/employee/sales/orders
Authorization: Bearer {token}
Content-Type: application/json

{
  "user_id": 1,
  "address_id": 1,
  "item_ids": [1, 2, 3],  // 可选，为空则使用全部采购单
  "remark": "备注信息"
}
```

## 五、前端实现建议

### 1. 项目结构
```
employee_app/
├── pages/
│   ├── login/          # 登录页
│   ├── delivery/       # 配送员页面
│   │   ├── orders/     # 订单列表
│   │   └── detail/     # 订单详情
│   └── sales/          # 销售员页面
│       ├── customers/  # 客户列表
│       ├── customer-detail/  # 客户详情
│       └── create-order/     # 创建订单
├── api/                # API 封装
├── utils/              # 工具函数
└── store/              # 状态管理
```

### 2. 关键功能实现

**登录状态管理**
- 使用 uni.setStorageSync 存储 token
- 使用拦截器自动添加 Authorization 头
- 实现 token 过期自动跳转登录

**配送员功能**
- 订单列表使用下拉刷新和上拉加载
- 订单详情显示地址、商品、联系方式
- 支持一键拨打电话、导航到地址
- 接单和完成配送需要确认操作

**销售员功能**
- 客户列表支持搜索
- 创建订单流程：选择客户 -> 选择商品 -> 选择地址 -> 确认订单
- 可以查看客户的采购单和历史订单

## 六、注意事项

1. **权限验证**：后端已实现角色验证，配送员只能访问配送相关接口，销售员只能访问销售相关接口
2. **订单状态**：兼容旧状态（pending, shipped, completed），自动映射到新状态
3. **客户归属**：销售员只能查看和操作自己绑定的客户（通过 sales_code 关联）
4. **安全性**：所有敏感操作都需要 token 验证，密码使用 bcrypt 加密

## 七、下一步工作

1. ✅ 后端 API 已全部实现
2. ⏳ 创建 uniappX 项目
3. ⏳ 实现登录页面
4. ⏳ 实现配送员功能页面
5. ⏳ 实现销售员功能页面
6. ⏳ 测试和优化

