# 富文本编辑功能使用说明

## 功能概述

本系统新增了富文本编辑功能，支持在后台管理系统中创建和编辑富文本内容（通知、活动页面等），并在小程序端通过固定页面展示。

## 功能特点

- ✅ 基于 Tiptap 富文本编辑器，功能强大且易用
- ✅ 支持多种内容类型：通知、活动、其他
- ✅ 支持草稿、发布、归档三种状态管理
- ✅ 支持富文本格式：标题、加粗、斜体、下划线、列表、引用等
- ✅ 自动统计浏览次数
- ✅ 小程序端通过 ID 访问已发布内容

## 一、后端实现

### 1. 数据库表结构

**✨ 系统自动创建**

富文本内容表会在系统启动时自动创建，无需手动执行任何脚本。当您启动后端服务时，系统会自动检测并创建 `rich_contents` 表。

表结构：
- `id`: 主键ID
- `title`: 富文本标题
- `content`: 富文本HTML内容
- `content_type`: 内容类型（notice/activity/other）
- `status`: 状态（draft/published/archived）
- `published_at`: 发布时间
- `view_count`: 浏览次数
- `created_by`: 创建人
- `updated_by`: 更新人

### 2. API接口

#### 管理端接口（需要认证）
- `GET /api/mini/admin/rich-contents` - 获取富文本内容列表
- `GET /api/mini/admin/rich-contents/:id` - 获取富文本内容详情
- `POST /api/mini/admin/rich-contents` - 创建富文本内容
- `PUT /api/mini/admin/rich-contents/:id` - 更新富文本内容
- `PUT /api/mini/admin/rich-contents/:id/publish` - 发布富文本内容
- `PUT /api/mini/admin/rich-contents/:id/archive` - 归档富文本内容
- `DELETE /api/mini/admin/rich-contents/:id` - 删除富文本内容

#### 小程序端接口（无需认证）
- `GET /api/mini/rich-contents` - 获取已发布的富文本内容列表
- `GET /api/mini/rich-contents/:id` - 获取已发布的富文本内容详情（自动增加浏览次数）

### 3. 文件清单

- `go_backend/internal/model/rich_content.go` - 数据模型
- `go_backend/internal/api/rich_content.go` - API接口
- `go_backend/internal/database/database.go` - 数据库初始化（已添加富文本表创建）
- `go_backend/cmd/main.go` - 路由配置（已更新）

## 二、后台管理系统

### 1. 安装依赖

依赖包已在 `package.json` 中配置：
- `@tiptap/vue-3` - Tiptap Vue 3 集成
- `@tiptap/pm` - ProseMirror 核心
- `@tiptap/starter-kit` - Tiptap 基础扩展包
- `@tiptap/extension-underline` - 下划线扩展

### 2. 访问路径

登录后台管理系统后，通过以下方式访问：

**方式一：通过菜单导航**
1. 在左侧菜单栏找到"营销管理"
2. 展开后点击"富文本内容"

**方式二：直接访问URL**
```
http://localhost:端口/rich-content
```

### 3. 功能操作

#### 创建富文本
1. 点击"创建富文本"按钮
2. 填写标题
3. 选择内容类型（通知/活动/其他）
4. 使用富文本编辑器编辑内容
5. 点击"保存"按钮（保存为草稿状态）

#### 编辑富文本
1. 在列表中点击"编辑"按钮
2. 修改内容
3. 点击"保存"按钮

#### 发布富文本
1. 在列表中点击"发布"按钮
2. 确认发布后，内容将对小程序端可见

#### 归档富文本
1. 对于已发布的内容，点击"归档"按钮
2. 归档后内容不再在小程序端显示

#### 复制小程序链接
1. 点击"复制小程序链接"按钮
2. 获得小程序页面路径，格式：`/pages/rich-content/rich-content?id=内容ID`

### 4. 富文本编辑工具栏

支持的格式：
- **B** - 加粗
- *I* - 斜体
- <u>U</u> - 下划线
- <s>S</s> - 删除线
- H1/H2/H3 - 标题
- ● 列表 - 无序列表
- 1. 列表 - 有序列表
- " 引用 - 引用块
- ─ 分割线 - 水平分割线
- ↶ 撤销
- ↷ 重做

### 5. 文件清单

- `admin_console/src/views/RichContent.vue` - 富文本管理页面
- `admin_console/src/api/richContent.js` - API接口封装
- `admin_console/src/router/index.js` - 路由配置（已更新）
- `admin_console/src/layout/Layout.vue` - 侧边栏菜单（已添加富文本入口）

## 三、小程序端

### 1. 页面路径

富文本显示页面：
```
/pages/rich-content/rich-content?id=内容ID
```

### 2. 使用方式

#### 方式一：通过链接跳转
```javascript
uni.navigateTo({
  url: '/pages/rich-content/rich-content?id=1'
})
```

#### 方式二：通过API获取列表
```javascript
import { getRichContentList } from '@/api/richContent'

// 获取已发布的通知列表
const result = await getRichContentList({
  page: 1,
  page_size: 10,
  content_type: 'notice'
})
```

### 3. 页面功能

- 自定义导航栏，支持返回
- 显示标题、发布时间、浏览次数
- 富文本内容渲染
- 自动增加浏览次数
- 加载状态和错误处理

### 4. 文件清单

- `mini_app/pages/rich-content/rich-content.vue` - 富文本显示页面
- `mini_app/api/richContent.js` - API接口封装
- `mini_app/pages.json` - 页面配置（已更新）

## 四、使用流程

### 快速开始

1. **启动后端服务**
   ```bash
   cd go_backend
   go run cmd/main.go
   ```
   系统会自动创建富文本内容表，无需手动执行任何迁移脚本。

2. **访问后台管理**
   - 登录后台管理系统
   - 左侧菜单 → 营销管理 → 富文本内容
   - 开始创建和管理富文本内容

### 完整流程示例

1. **后台创建内容**
   - 登录后台管理系统
   - 进入"富文本内容管理"
   - 点击"创建富文本"
   - 填写标题："新春活动通知"
   - 选择类型："活动"
   - 编辑内容（使用富文本编辑器）
   - 点击"保存"（此时状态为"草稿"）

2. **发布内容**
   - 在列表中找到刚创建的内容
   - 点击"发布"按钮
   - 确认发布

3. **复制链接**
   - 点击"复制小程序链接"
   - 获得路径：`/pages/rich-content/rich-content?id=1`

4. **小程序中使用**
   - 在小程序中通过该路径跳转
   - 用户可以查看富文本内容
   - 系统自动记录浏览次数

## 五、注意事项

1. **权限管理**
   - 后台管理接口需要管理员认证
   - 小程序端只能查看已发布的内容

2. **内容安全**
   - 富文本内容直接渲染HTML，请注意内容审核
   - 建议对用户输入进行适当过滤

3. **状态流转**
   - 草稿 → 发布 → 归档
   - 归档后的内容不会在小程序端显示

4. **数据库维护**
   - 定期清理已归档或过期的内容
   - 浏览次数数据可用于统计分析

## 六、扩展建议

如需扩展功能，可以考虑：

1. **图片上传**
   - 集成图片上传功能
   - 在富文本编辑器中插入图片

2. **定时发布**
   - 添加定时发布功能
   - 设置发布时间

3. **内容分类标签**
   - 添加标签系统
   - 支持按标签筛选

4. **评论功能**
   - 允许用户评论
   - 互动交流

5. **分享功能**
   - 添加分享按钮
   - 生成分享海报

## 七、技术支持

如有问题，请参考：
- Tiptap 官方文档：https://tiptap.dev/docs/editor/getting-started/install/vue3
- Element Plus 官方文档：https://element-plus.org/
- Uni-app 官方文档：https://uniapp.dcloud.net.cn/

---

**最后更新时间：** 2025-12-20

